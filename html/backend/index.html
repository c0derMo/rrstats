<!DOCTYPE html>
<html>
    <head>
        <title>RR Player Statistics</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.min.css">
    </head>
    <body>
        <div class="ui container">
            <div class="ui basic modal" id="shutdownConfirmModal">
                <div class="ui icon header">
                    <i class="power off icon"></i>
                    Shutdown server
                </div>
                <div class="content">
                    <p>Are you sure that you want to <span style="font-weight: bold;">shutdown the server?</span></p>
                    <div class="actions">
                        <div class="ui red basic cancel inverted button">
                            <i class="remove icon"></i>
                            No
                        </div>
                        <div class="ui green ok inverted button" id="shutdownConfirm">
                            <i class="checkmark icon"></i>
                            Yes
                        </div>
                    </div>
                </div>
            </div>
            <br>
            <h1 class="ui header">RR Player Stats - Backend</h1>
            <a class="negative ui right floated button" href="/backend/logout"><i class="sign out alternative icon"></i>Logout</a>
            <br>
            <br>
            <br>
            <div class="ui middle aligned divided list" id="menu">
                
            </div>
        </div>

        <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.min.js"></script>
        <script>
            $.getJSON("/backend/api/menu", (data, status, x) => {
                if(status == "success") {
                    data.forEach(element => {
                        const icon = $('<i></i>').addClass("large").addClass(element.icon).addClass("middle aligned icon");

                        const title = $('<a></a>').addClass("header").css("font-weight", "bold").text(element.title);
                        const description = $('<div></div>').addClass("description").text(element.description);
                        const content = $("<div></div>").addClass("content").append(title).append(description);

                        const rightFloatedContent = $('<div></div>').addClass("right floated content");

                        switch(element.type) {
                            case "link":
                                const link = $('<a></a>').addClass("ui button").attr("href", element.href).append($("<i></i>").addClass("share icon"));
                                rightFloatedContent.append(link);
                                break;
                            case "button":
                                const button = $("<button>").addClass("ui button").attr("id", element.id).append($('<i></i>').addClass(element.icon).addClass("icon"));
                                rightFloatedContent.append(button);
                                break;
                            case "checkbox":
                                const checkbox = $('<input></input>').attr("type", "checkbox").attr("id", element.id);
                                const box = $('<div></div>').addClass("ui toggle checkbox").append(checkbox).append($('<label></label>'));
                                rightFloatedContent.append(box);
                                break;
                        }

                        const item = $('<div></div>').addClass("item").append(rightFloatedContent).append(icon).append(content);
                        $('#menu').append(item);
                    });

                    addHandlers();
                }
            });

            function addHandlers() {
                $('#maintenance-mode').on("click", (e) => {
                    if($('#maintenance-mode').prop("checked")) {
                        $.get("/backend/api/maintenance", {mode: "on"}, (data, status, x) => {
                            console.log(data);
                            console.log(status);
                            $('body').toast({
                                message: "Maintenance mode: enabled.",
                                showProgress: 'top',
                                class: 'success',
                                displayTime: 15000
                            })
                        });
                    } else {
                        $.get("/backend/api/maintenance", {mode: "off"}, (data, status, x) => {
                            console.log(data);
                            console.log(status);
                            $('body').toast({
                                message: "Maintenance mode: disabled.",
                                showProgress: 'top',
                                class: 'success',
                                displayTime: 15000
                            })
                        });
                    }
                });

                $('#reload').on("click", (e) => {
                    $.get("/backend/api/reloadConfigs", (data, status, x) => {
                        if(status === "success" && data.status === "ok") {
                            $('body').toast({
                                message: 'Successfully reloaded the config files.',
                                showProgress: 'top',
                                class: 'success'
                            });
                        } else {
                            $('body').toast({
                                message: "Failed to reload the files.",
                                showProgress: 'top',
                                class: 'failure'
                            })
                        }
                    })
                });


                $('#recalcLeaderboard').on("click", (e) => {
                    $.get("/backend/api/recalculateLeaderboards", (data, status, x) => {
                        if(status === "success" && data.status === "ok") {
                            $('body').toast({
                                message: 'Successfully recalculated leaderboard info.',
                                showProgress: 'top',
                                class: 'success'
                            });
                        } else {
                            $('body').toast({
                                message: "Failed to recalculate leaderboard info.",
                                showProgress: 'top',
                                class: 'failure'
                            })
                        }
                    })
                });

                $('#shutdown').on("click", (e) => {
                    $('#shutdownConfirmModal').modal("show");
                })

                $('#shutdownConfirm').on("click", (e) => {
                    $.get("/backend/api/shutdown", (data, status, x) => {
                        $('body').toast({
                            message: 'Sent shutdown command.',
                            showProgress: 'top',
                            class: 'success'
                        });
                    })
                })
            }
        </script>
    </body>
</html>