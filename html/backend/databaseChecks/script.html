<script>

    let rr1SupressionToggle = true;

    $('#step1_finish').on("click", () => {
        $('#step1_content').slideUp();
        $('#step2_content').slideDown();
        $('#step1').removeClass("active").addClass("completed");
        $('#step2').addClass("active");

        let chks = [];

        if($('#score').is(':checked')) chks.push("score");
        if($('#matchesWithoutPlayers').is(':checked')) chks.push("matchesWithoutPlayers");
        if($('#playersWithoutMatches').is(':checked')) chks.push("playersWithoutMatches");

        $.ajax("/backend/api/runDatabaseChecks", {
            data: {
                checks: JSON.stringify(chks)
            },
            method: 'POST',
            success: (data, status, x) => {
                let rr1Supression = 0;
                data.errors.forEach(element => {
                    if(element.includes("RR1") && rr1SupressionToggle) {
                        rr1Supression += 1;
                    } else {
                        $('#results').append($('<tr></tr>').append($("<td><i class='exclamation icon'></i></td>")).append($("<td></td>").text(element)).addClass("negative"));
                    }
                });
                data.warnings.forEach(element => {
                    if(element.includes("RR1") && rr1SupressionToggle) {
                        rr1Supression += 1;
                    } else {
                        $('#results').append($('<tr></tr>').append($("<td><i class='question icon'></i></td>")).append($("<td></td>").text(element)).addClass("warning"));
                    }
                });

                if(data.warnings.length === 0 && data.errors.length === 0) {
                    $('#results').append($('<tr></tr>').addClass("positive").append($('<td></td>')).append($('<td>No errors found!</td>')))
                }
                if(rr1Supression > 0) {
                    $('#results').append($('<tr></tr>').addClass("warning").append($('<td><i class="question icon"></i></td>')).append($('<td>Suppressed RR1 warnings & errors: ' + rr1Supression + '</td>')))
                }
                $('#step2').removeClass("active").addClass("completed");
                $('#step3').addClass("active");
                $('#step2_content').slideUp();
                $('#step3_content').slideDown();
            },
            error: (data, status, x) => {
                console.log(data);
            }
        })
    });

</script>